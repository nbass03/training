<!DOCTYPE html>
<html lang="fr">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="apple-touch-icon" sizes="180x180" href="img/icon-180-v2.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#121212">
  <meta name="color-scheme" content="dark">
  <title>Mon Programme</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 0;
      padding: 0;
      background: #121212;
      color: #f5f5f5;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    h1, h2, h4, p { margin: 10px 0; }
    .page { display: none; flex: 1; flex-direction: column; text-align: center; padding: 20px; overflow-y: auto;  padding-bottom: 300px; }
    .active { display: flex; }

    .button {
      display: block;
      text-decoration: none;
      text-align: center;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
    }

    .home-buttons .button {
      background: #F2F2F7;  
      color: #000;           
      font-weight: 500;
      font-size: 20px;
      border-radius: 16px;
      padding: 16px;
      margin: 12px 0;
      box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    }
    .home-buttons .button:active {
      background: #E5E5EA;
      transform: scale(0.98);
    }

    .grid { display: flex; flex-direction: column; gap: 15px; width: 100%; margin: 20px 0; align-content: center; }
    .card { background: #1e1e1e; border-radius: 10px; padding: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.4); }
    .card img { width: 100%; border-radius: 8px; }

    .superset { display: flex; flex-direction: column; gap: 15px; margin: 20px 0; width: 100%; align-items: stretch; align-content: center; flex-wrap: wrap; }
    #dayGrid .exercise {
      display: flex;
      gap: 12px;
      background: #1e1e1e;
      border-radius: 10px;
      padding: 10px;
      width: 100%;
      flex-direction: row;
      justify-content: left;
      text-align: left;
      box-shadow: 0 2px 6px rgba(0,0,0,0.4);
    }
    #dayGrid .exercise img { width: 40%; border-radius: 8px; }
    #dayGrid .exercise .exercise_info { display: flex; flex-direction: column; justify-content: center; }
    .exercise { background: #1e1e1e; border-radius: 10px; padding: 10px; width: 100%; box-shadow: 0 2px 6px rgba(0,0,0,0.4); }
    .exercise img { width: 100%; border-radius: 8px; }
    .pause { margin-top: 10px; font-size: 16px; font-style: italic; color: #bbb; }

    .nav-buttons {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #121212;
      padding: 10px 20px 20px;
      display: flex;
      justify-content: space-between;
      gap: 10px;
      box-shadow: 0 -2px 6px rgba(0,0,0,0.4);
    }
    .nav-buttons .button.retour {
      flex: 1;
      max-width: 120px;
      background: #E5E5EA;
      color: #000;
      font-weight: 500;
      border-radius: 12px;
      padding: 12px;
    }
    .nav-buttons .button.retour:active { background: #CACACA; }
    .nav-buttons .button.suivant {
      flex: 2;
      background: #0A84FF;
      color: #fff;
      font-weight: 600;
      border-radius: 12px;
      padding: 12px;
    }
    .nav-buttons .button.suivant:active { background: #0060DF; }
    #home { justify-content: flex-start; padding-top: 40px; }
    .home-buttons { display: flex; flex-direction: column; justify-content: center; flex: 1; }

    .reset { margin-top: 8px; background: #0A84FF; color: #fff; border: none; border-radius: 12px; padding: 10px 16px; cursor: pointer; }
    .reset:active { background: #0060DF; }
  </style>
</head>
<body>

<!-- Page accueil -->
<div id="home" class="page active">
  <h1>Mon Programme</h1>
  <div class="home-buttons">
    <a href="#" class="button" onclick="openDay(1)">Jour 1</a>
    <a href="#" class="button" onclick="openDay(2)">Jour 2</a>
    <a href="#" class="button" onclick="openDay(3)">Jour 3</a>
  </div>
</div>

<!-- Page Jour -->
<div id="dayPage" class="page">
  <h2 id="dayTitle">Jour X</h2>
  <div class="grid" id="dayGrid"></div>
  <div class="nav-buttons">
    <a href="#" class="button retour" onclick="goHome()">Retour</a>
    <a href="#" class="button suivant" onclick="startWorkout()">Démarrer</a>
  </div>
</div>

<!-- Page Entraînement -->
<div id="workoutPage" class="page">
  <h2 id="blockTitle">Bloc 1</h2>
  <div class="superset" id="supersetBlock"></div>
  <div class="pause">
    Repos : <span id="pauseTime">--</span>
    <br>
    <button class="reset" onclick="startRest(); initAudio();">Démarrer / Reset repos</button>
  </div>
  <div class="nav-buttons">
    <a href="#" class="button retour">Retour</a>
    <a href="#" class="button suivant" onclick="nextBlock()">Suivant</a>
  </div>
</div>

<script>
const programme = {
  1: [
    { pause: "75s", exos: [{ nom: "Incline DB chest press", reps: "4 x 8", img: "img/incline-db.jpg" }, { nom: "Lat pull down", reps: "4 x 8", img: "img/lat.jpg" }] },
    { pause: "75s", exos: [{ nom: "Hammer chest press", reps: "3 x 10", img: "img/hammer.jpg" }, { nom: "Seated row", reps: "3 x 10", img: "img/seated-row.jpg" }] },
    { pause: "75s", exos: [{ nom: "Pec deck", reps: "3 x 8à10", img: "img/pec-deck.jpg" }, { nom: "Suppinated BB row", reps: "3 x 10à12", img: "img/supinated.jpg" }] },
    { pause: "1min", exos: [{ nom: "Seated chest press dropset", reps: "3 x 7-7-7", img: "img/chest-press.jpg" }] },
    { pause: "1min", exos: [{ nom: "Straight arm pulldown dropset", reps: "3 x 7-7-7", img: "img/pulldown.gif" }] },
    { pause: "30s", exos: [{ nom: "Flutter kicks", reps: "3 x 40", img: "img/flutter.jpg" }] },
  ],
  2: [
    { pause: "1min", exos: [{ nom: "Squat", reps: "4 x 8", img: "img/squat.jpg" }] },
    { pause: "1min", exos: [{ nom: "Leg press", reps: "3 x 10", img: "img/leg-press.jpg" }, { nom: "Glute ham raise", reps: "3 x 10", img: "img/ham-raise.jpg" }] },
    { pause: "90s", exos: [{ nom: "Walking lunges", reps: "4 x 20", img: "img/walking-lunges.jpg" }, { nom: "Leg curl debout", reps: "4 x 10 par jambe", img: "img/leg-curl.jpg" }] },
    { pause: "60s", exos: [{ nom: "Leg extension dropset", reps: "3 x 7-7-7", img: "img/leg-extension.jpg" }] },
    { pause: "90s", exos: [{ nom: "Leg curl dropset", reps: "3 x 7-7-7", img: "img/leg-curl-couche.jpg" }] }
  ],
  3: [
    { pause: "90s", exos: [{ nom: "Upright row", reps: "5 x 10", img: "img/upright-row.jpg" }, { nom: "Lateral raise", reps: "5 x 10", img: "img/lateral-raise.jpg" }] },
    { pause: "1min", exos: [{ nom: "Incline biceps curl", reps: "4 x 8", img: "img/incline-biceps-curl.jpg" }, { nom: "BB triceps pushdown", reps: "4 x 8", img: "img/triceps-pushdown.jpg" }] },
    { pause: "2min", exos: [{ nom: "Biceps curl alterné", reps: "4 x 16", img: "img/curl-biceps-alterne.gif" }, { nom: "Lying triceps extension", reps: "4 x 12", img: "img/lying-triceps-extension.jpg" }] },
    { pause: "1min", exos: [{ nom: "Crunch sur BOSU", reps: "3 x 15", img: "img/crunch.jpg" }, { nom: "Knee raise", reps: "3 x 15", img: "img/knee-raise.jpg" }] }
  ]
};


let currentDay = 1;
let currentBlock = 0;
let restInterval;

// --- NOUVEAU BEEP VIA WEB AUDIO ---
function playBeep() {
  try {
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const ctx = new AudioContext();
    const oscillator = ctx.createOscillator();
    const gainNode = ctx.createGain();

    oscillator.connect(gainNode);
    gainNode.connect(ctx.destination);

    oscillator.type = 'square';
    oscillator.frequency.setValueAtTime(1000, ctx.currentTime);
    gainNode.gain.setValueAtTime(0.2, ctx.currentTime);

    oscillator.start();
    oscillator.stop(ctx.currentTime + 0.2); // 200ms

    oscillator.onended = () => ctx.close();
  } catch (e) {
    console.log("Impossible de jouer le beep:", e);
  }
}

// --- LOGIQUE DES PAGES ---
function showPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function goHome() { showPage('home'); }

function openDay(day) {
  currentDay = day;
  document.getElementById('dayTitle').innerText = "Jour " + day;
  const grid = document.getElementById('dayGrid');
  grid.innerHTML = '';

  const dayProgram = programme[day];

  dayProgram.forEach((bloc, i) => {
    let blocHTML = `<div class="superset">
      <h3>Bloc ${i + 1} (Repos: ${bloc.pause})</h3>`;
    bloc.exos.forEach(exo => {
      blocHTML += `<div class="exercise">
        <img src="${exo.img}" alt="">
        <div class="exercise_info">
        <h4>${exo.nom}</h4>
        <p>${exo.reps}</p>
        </div>
      </div>`;
    });
    blocHTML += `</div>`;
    grid.innerHTML += blocHTML;
  });

  document.querySelector('#dayPage .button.suivant').innerText = "Démarrer";
  showPage('dayPage');
}

function startWorkout() {
  currentBlock = 0;
  showBlock();
  showPage('workoutPage');
}

function showBlock() {
  clearInterval(restInterval);
  const bloc = programme[currentDay][currentBlock];
  document.getElementById('blockTitle').innerText = "Bloc " + (currentBlock + 1);
  const supersetDiv = document.getElementById('supersetBlock');
  supersetDiv.innerHTML = '';
  bloc.exos.forEach(exo => {
    supersetDiv.innerHTML += `<div class="exercise"><img src="${exo.img}" alt=""><h4>${exo.nom}</h4><p>${exo.reps}</p></div>`;
  });
  document.getElementById('pauseTime').innerText = bloc.pause;
}

function parsePause(pause) {
  if (pause.includes("min")) return parseInt(pause) * 60;
  if (pause.includes("s")) return parseInt(pause);
  return 60;
}

function startRest() {
  clearInterval(restInterval);
  let duration = parsePause(programme[currentDay][currentBlock].pause);
  const display = document.getElementById("pauseTime");

  function update() {
    let minutes = Math.floor(duration / 60);
    let seconds = duration % 60;
    display.textContent = minutes > 0 ? `${minutes}:${seconds.toString().padStart(2,"0")}` : `${seconds}s`;

    if (duration <= 0) {
      clearInterval(restInterval);
      playBeep(); // beep sans couper la musique
    }
    duration--;
  }

  update();
  restInterval = setInterval(update, 1000);
}

function nextBlock() {
  if (currentBlock < programme[currentDay].length - 1) {
    currentBlock++;
    showBlock();
  } else {
    alert("Entraînement terminé 🎉");
    goHome();
  }
}

document.querySelector('#workoutPage .button.retour').onclick = function(e) {
  e.preventDefault();
  if (currentBlock > 0) currentBlock--;
  showBlock();
};
</script>
</body>
</html>
